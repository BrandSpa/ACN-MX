(function(e,d){var b=e.customize,f=e.media&&e.media.gallery;b&&f&&(b.Youxi=b.Youxi||{},b.Youxi.GalleryControl=b.Control.extend({ids:function(){var a=this.setting();return a&&a.length?' ids="'+a.join(",")+'"':""},createView:function(a){return a.map(function(a){a=this.attachmentSize(a,"thumbnail").url;return d("<div />").append(d("<img />").attr("src",a))},this)},open:function(a){if(!b.utils.isKeydownButNotEnterEvent(a)){a.preventDefault();var c=f.edit("[gallery"+this.ids()+"]");c.state("gallery-edit").on("update",this.update);c.on("close",function(){c.detach()})}},update:function(a){var c;c=a.pluck("id");c=_.map(c,function(a){return d("<option />").val(a).text(a).prop("selected",!0)},this);this.dropdown.html(c);this.view.html(this.createView(a));this.clearBtn.show();this.setting.set(this.dropdown.val())},clear:function(a){b.utils.isKeydownButNotEnterEvent(a)||(a.preventDefault(),this.dropdown.empty(),this.view.empty(),this.clearBtn.hide(),this.setting.set([]))},attachmentSize:function(a,c){var b=a.attributes.sizes||{};return _.has(b,c)?_.pick(b[c],"url"):{url:a.url}},ready:function(){this.dropdown=this.container.find(".youxi-gallery-control-dropdown").hide();this.view=this.container.find(".youxi-gallery-control-view");this.clearBtn=this.container.find(".youxi-gallery-control-clear");_.bindAll(this,"open","update","clear");this.view.on("click keydown",this.open);this.clearBtn.on("click keydown",this.clear)}}),d.extend(b.controlConstructor,{youxi_gallery:b.Youxi.GalleryControl}))})(window.wp,jQuery);